<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://unonibes4a.github.io/pintaresta/toolscanvsa2025dc.js"></script>
    <title>Pintaresta Gallery</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background: #ffffff;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
        }
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #ffffff;
            padding: 16px 24px;
            z-index: 1000;
            box-shadow: 0 1px 0 rgba(0, 0, 0, 0.08);
        }
        .header-content {
            max-width: 1640px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }
        .logo {
            font-size: 24px;
            font-weight: 700;
            color: #e60023;
            text-decoration: none;
            padding: 12px 16px;
            border-radius: 24px;
            transition: background-color 0.2s;
        }
        .logo:hover {
            background-color: #f0f0f0;
        }
        .search-container {
            flex: 1;
            max-width: 800px;
        }
        .search-bar {
            display: flex;
            align-items: center;
            background: #efefef;
            border-radius: 24px;
            padding: 12px 16px;
        }
        .search-bar input {
            flex: 1;
            border: none;
            background: transparent;
            outline: none;
            font-size: 16px;
            color: #333;
            padding: 0 8px;
        }
        .nav-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .nav-btn {
            background: #efefef;
            border: none;
            padding: 10px 20px;
            border-radius: 24px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            color: #211922;
            position: relative;
        }
        .nav-btn:hover:not(:disabled) {
            background: #e1e1e1;
        }
        .nav-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        .nav-btn.upload-btn {
            background: #00d084;
            color: white;
        }
        .nav-btn.upload-btn:hover {
            background: #00b872;
        }
        .nav-btn input[type="file"] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        .lote-info {
            padding: 8px 16px;
            background: #efefef;
            border-radius: 24px;
            font-size: 12px;
            color: #5f5f5f;
            font-weight: 500;
        }
        .main-content {
            margin-top: 80px;
            padding: 0 16px;
        }
        .pins-container {
            column-count: 5;
            column-gap: 16px;
            max-width: 1640px;
            margin: 0 auto;
        }
        @media (max-width: 1536px) { .pins-container { column-count: 4; } }
        @media (max-width: 1280px) { .pins-container { column-count: 3; } }
        @media (max-width: 900px) { .pins-container { column-count: 2; } }
        @media (max-width: 600px) { .pins-container { column-count: 1; } }
        .pin {
            break-inside: avoid;
            margin-bottom: 16px;
            cursor: pointer;
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.3s ease;
            background: #ffffff;
        }
        .pin:hover {
            transform: scale(1.02);
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.1);
        }
        .pin-image-container {
            position: relative;
            width: 100%;
            overflow: hidden;
            border-radius: 16px;
        }
        .pin-image {
            width: 100%;
            display: block;
            transition: transform 0.3s ease;
            object-fit: cover;
        }
        .pin:hover .pin-image {
            transform: scale(1.03);
        }
        video.pin-image {
            background: #000;
        }
        video.pin-image::-webkit-media-controls {
            display: none !important;
        }
        .save-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            background: #e60023;
            color: #ffffff;
            border: none;
            padding: 10px 16px;
            border-radius: 24px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            opacity: 0;
            transform: translateY(-4px);
            transition: all 0.2s;
        }
        .pin:hover .save-btn {
            opacity: 1;
            transform: translateY(0);
        }
        .save-btn:hover {
            background: #ad081b;
        }
        .pin-info {
            padding: 12px;
            background: #ffffff;
        }
        .pin-title {
            font-size: 14px;
            font-weight: 600;
            color: #211922;
            margin-bottom: 4px;
        }
        .pin-description {
            font-size: 12px;
            color: #5f5f5f;
        }
        .pin-creator {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #efefef;
        }
        .creator-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #e60023, #ff006e);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ffffff;
            font-weight: 600;
            font-size: 12px;
        }
        .creator-name {
            font-size: 12px;
            color: #211922;
            font-weight: 500;
        }
        .h-280 { height: 280px; }
        .h-320 { height: 320px; }
        .h-360 { height: 360px; }
        .h-400 { height: 400px; }
        .h-440 { height: 440px; }
        .media-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(230, 0, 35, 0.9);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            flex-direction: column;
            gap: 20px;
        }
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #efefef;
            border-top: 4px solid #e60023;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .loading-text {
            font-size: 16px;
            color: #5f5f5f;
        }
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .modal-overlay.active {
            display: flex;
        }
        .modal-content {
            background: white;
            border-radius: 16px;
            max-width: 800px;
            width: 100%;
            max-height: 80vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #efefef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-header h2 {
            margin: 0;
            color: #211922;
            font-size: 18px;
        }
        .modal-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }
        .json-preview {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .modal-footer {
            padding: 20px;
            border-top: 1px solid #efefef;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        .btn-modal {
            padding: 10px 20px;
            border: none;
            border-radius: 24px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-modal.primary {
            background: #e60023;
            color: white;
        }
        .btn-modal.primary:hover {
            background: #ad081b;
        }
        .btn-modal.secondary {
            background: #efefef;
            color: #211922;
        }
        .btn-modal.secondary:hover {
            background: #e1e1e1;
        }
        .stats-box {
            background: #f0f7ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .stats-box h3 {
            margin: 0 0 10px 0;
            color: #0066ff;
            font-size: 14px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        .stat-item {
            text-align: center;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #211922;
        }
        .stat-label {
            font-size: 12px;
            color: #5f5f5f;
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <div class="loading-screen" id="loadingScreen" style="display: none;">
        <div class="loading-spinner"></div>
        <div class="loading-text">Cargando multimedia...</div>
    </div>
    <div class="modal-overlay" id="modalJSON">
        <div class="modal-content">
            <div class="modal-header">
                <h2>JSON de Archivos Cargados</h2>
                <button class="btn-modal secondary" id="btnCloseModal">X</button>
            </div>
            <div class="modal-body">
                <div class="stats-box" id="statsContainer"></div>
                <div class="json-preview" id="jsonPreview"></div>
            </div>
            <div class="modal-footer">
                <button class="btn-modal secondary" id="btnCopyJSON">Copiar JSON</button>
                <button class="btn-modal primary" id="btnDownloadJSON">Descargar JSON</button>
            </div>
        </div>
    </div>
    <div class="header">
        <div class="header-content">
            <a href="#" class="logo">PINTARESTA</a>
            <div class="search-container">
                <div class="search-bar">
                    <span>Buscar</span>
                    <input type="text" id="searchInput" placeholder="Buscar media...">
                </div>
            </div>
            <div class="lote-info" id="loteInfo">Cargando...</div>
            <div class="nav-buttons">
                <button class="nav-btn upload-btn" id="btnUploadFolder">
                    Cargar Carpeta
                    <input type="file" id="fileInput" webkitdirectory directory multiple accept="image/*,video/*">
                </button>
                <button class="nav-btn" id="btnViewJSON" style="display: none;">Ver JSON</button>
                <button class="nav-btn" id="btnBack" disabled>Atras</button>
                <button class="nav-btn" id="btnReload">Recargar</button>
                <button class="nav-btn" id="btnNext" disabled>Siguiente</button>
            </div>
        </div>
    </div>
    <div class="main-content">
        <div class="pins-container" id="pinsContainer"></div>
    </div>
    <script>
        class PintarestaGallery {
            constructor() {
                this.todasLasUrls = [];
                this.urlsFiltradas = [];
                this.loteActual = 0;
                this.imagenesPorLote = 30;
                this.repositorios = [
                    { owner: 'unonibes4a', name: 'newImgs' },
                    { owner: 'unonibes4a', name: 'newimg2' },
                    { owner: 'unonibes4a', name: 'newimg3' }
                ];
                this.extensionesValidas = {
                    imagen: ['.jpg', '.jpeg', '.png', '.gif', '.bmp', '.webp', '.svg', '.tiff', '.tif', '.ico', '.heic', '.heif'],
                    video: ['.mp4', '.webm', '.avi', '.mov', '.mkv', '.flv', '.wmv', '.m4v', '.mpeg', '.mpg', '.3gp']
                };
                this.jsonData = null;
            }
            esImagen(nombreArchivo) {
                const ext = nombreArchivo.toLowerCase().substring(nombreArchivo.lastIndexOf('.'));
                return this.extensionesValidas.imagen.includes(ext);
            }
            esVideo(nombreArchivo) {
                const ext = nombreArchivo.toLowerCase().substring(nombreArchivo.lastIndexOf('.'));
                return this.extensionesValidas.video.includes(ext);
            }
            esMediaValido(nombreArchivo) {
                return this.esImagen(nombreArchivo) || this.esVideo(nombreArchivo);
            }
            obtenerNombreArchivo(path) {
                return path.split('/').pop().replace(/\.[^/.]+$/, "");
            }
            formatBytes(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
            barajarArray(array) {
                const shuffled = [...array];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                return shuffled;
            }
            async cargarDesdeDirectorio(url, rutaBase = '', repoName = '') {
                const urls = [];
                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        return urls;
                    }
                    const data = await response.json();
                    for (const item of data) {
                        if (item.type === 'file' && this.esMediaValido(item.name)) {
                            const esVideo = this.esVideo(item.name);
                            urls.push({
                                url: item.download_url,
                                nombre: this.obtenerNombreArchivo(item.name),
                                repo: repoName,
                                tipo: esVideo ? 'video' : 'imagen',
                                extension: item.name.toLowerCase().substring(item.name.lastIndexOf('.'))
                            });
                        } else if (item.type === 'dir') {
                            const subUrls = await this.cargarDesdeDirectorio(item.url, `${rutaBase}${item.name}/`, repoName);
                            urls.push(...subUrls);
                        }
                    }
                } catch (error) {
                }
                return urls;
            }
            async cargarDesdeRepositorio(repo) {
                const githubApiUrl = `https://api.github.com/repos/${repo.owner}/${repo.name}/contents`;
                try {
                    const urls = await this.cargarDesdeDirectorio(githubApiUrl, '', repo.name);
                    return urls;
                } catch (error) {
                    return [];
                }
            }
            async cargarDesdeMultiplesRepos() {
                this.mostrarCargando(true);
                try {
                    const promesas = this.repositorios.map(repo => this.cargarDesdeRepositorio(repo));
                    const resultados = await Promise.all(promesas);
                    const todosLosArchivos = resultados.flat();
                    if (todosLosArchivos.length === 0) {
                        throw new Error('No se encontraron archivos multimedia');
                    }
                    return this.barajarArray(todosLosArchivos);
                } catch (error) {
                    document.getElementById('pinsContainer').innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #767676; grid-column: 1/-1;">
                            <h3>Error cargando archivos</h3>
                            <p>${error.message}</p>
                        </div>
                    `;
                    return [];
                } finally {
                    this.mostrarCargando(false);
                }
            }
            async procesarArchivosLocales(files) {
                const archivosValidos = [];
                const promesas = [];
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    const extension = file.name.substring(file.name.lastIndexOf('.')).toLowerCase();
                    if (this.esMediaValido(file.name)) {
                        promesas.push(
                            new Promise((resolve) => {
                                const reader = new FileReader();
                                reader.onload = (e) => {
                                    archivosValidos.push({
                                        url: e.target.result,
                                        nombre: this.obtenerNombreArchivo(file.name),
                                        nombreCompleto: file.name,
                                        repo: 'Local',
                                        tipo: this.esVideo(file.name) ? 'video' : 'imagen',
                                        extension: extension,
                                        tamaño: file.size,
                                        tamañoLegible: this.formatBytes(file.size),
                                        fechaModificacion: file.lastModified,
                                        ruta: file.webkitRelativePath || file.name
                                    });
                                    resolve();
                                };
                                reader.readAsDataURL(file);
                            })
                        );
                    }
                }
                await Promise.all(promesas);
                this.jsonData = {
                    fecha_generacion: new Date().toISOString(),
                    total_archivos: archivosValidos.length,
                    imagenes: archivosValidos.filter(a => a.tipo === 'imagen').length,
                    videos: archivosValidos.filter(a => a.tipo === 'video').length,
                    archivos: archivosValidos.map(a => ({
                        nombre: a.nombre,
                        nombreCompleto: a.nombreCompleto,
                        ruta: a.ruta,
                        tipo: a.tipo,
                        extension: a.extension,
                        tamaño: a.tamañoLegible,
                        fechaModificacion: new Date(a.fechaModificacion).toISOString()
                    }))
                };
                return archivosValidos;
            }
            async cargarArchivosLocales(files) {
                this.mostrarCargando(true);
                try {
                    const archivosLocales = await this.procesarArchivosLocales(files);
                    if (archivosLocales.length === 0) {
                        alert('No se encontraron imagenes o videos validos en la carpeta seleccionada');
                        return;
                    }
                    this.todasLasUrls = this.barajarArray(archivosLocales);
                    this.urlsFiltradas = [...this.todasLasUrls];
                    this.loteActual = 0;
                    this.mostrarLote();
                    document.getElementById('btnViewJSON').style.display = 'block';
                    alert(`Cargados ${archivosLocales.length} archivos locales\n\nImagenes: ${this.jsonData.imagenes}\nVideos: ${this.jsonData.videos}`);
                } catch (error) {
                    alert('Error al cargar archivos: ' + error.message);
                } finally {
                    this.mostrarCargando(false);
                }
            }
            mostrarJSON() {
                if (!this.jsonData) {
                    alert('No hay JSON generado. Primero carga una carpeta con archivos.');
                    return;
                }
                const modal = document.getElementById('modalJSON');
                const statsContainer = document.getElementById('statsContainer');
                const jsonPreview = document.getElementById('jsonPreview');
                statsContainer.innerHTML = `
                    <h3>Estadisticas de Archivos</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-number">${this.jsonData.total_archivos}</div>
                            <div class="stat-label">Total</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">${this.jsonData.imagenes}</div>
                            <div class="stat-label">Imagenes</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">${this.jsonData.videos}</div>
                            <div class="stat-label">Videos</div>
                        </div>
                    </div>
                `;
                const jsonLimpio = {
                    ...this.jsonData,
                    nota: "Las URLs base64 se han omitido para mayor legibilidad"
                };
                jsonPreview.textContent = JSON.stringify(jsonLimpio, null, 2);
                modal.classList.add('active');
            }
            descargarJSON() {
                if (!this.jsonData) return;
                const dataStr = JSON.stringify(this.jsonData, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `galeria_multimedia_${new Date().getTime()}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                alert('JSON descargado correctamente');
            }
            copiarJSON() {
                if (!this.jsonData) return;
                const jsonStr = JSON.stringify(this.jsonData, null, 2);
                navigator.clipboard.writeText(jsonStr).then(() => {
                    alert('JSON copiado al portapapeles');
                }).catch(err => {
                    alert('Error al copiar JSON');
                });
            }
            mostrarCargando(mostrar) {
                const loading = document.getElementById('loadingScreen');
                loading.style.display = mostrar ? 'flex' : 'none';
            }
            crearPinElement(mediaData) {
                const pin = document.createElement('div');
                pin.className = 'pin';
                const alturas = ['h-280', 'h-320', 'h-360', 'h-400', 'h-440'];
                const alturaAleatoria = alturas[Math.floor(Math.random() * alturas.length)];
                const esVideo = mediaData.tipo === 'video';
                const esLocal = mediaData.repo === 'Local';
                if (esVideo) {
                    pin.innerHTML = `
                        <div class="pin-image-container">
                            <video class="pin-image ${alturaAleatoria}" ${esLocal ? 'src' : 'data-src'}="${mediaData.url}" muted loop playsinline preload="none">
                                Tu navegador no soporta videos.
                            </video>
                            <div class="media-badge">VIDEO</div>
                            <button class="save-btn">Guardar</button>
                        </div>
                        <div class="pin-info">
                            <div class="pin-title">${mediaData.nombre}</div>
                            <div class="pin-description">${mediaData.repo}${esLocal && mediaData.tamañoLegible ? ' - ' + mediaData.tamañoLegible : ''}</div>
                            <div class="pin-creator">
                                <div class="creator-avatar">${esLocal ? 'PC' : 'GH'}</div>
                                <div class="creator-name">${esLocal ? 'Mi PC' : 'GitHub'}</div>
                            </div>
                        </div>
                    `;
                    const videoElement = pin.querySelector('video');
                    if (!esLocal && videoElement.dataset.src) {
                        const observer = new IntersectionObserver((entries) => {
                            entries.forEach(entry => {
                                if (entry.isIntersecting && videoElement.dataset.src) {
                                    videoElement.src = videoElement.dataset.src;
                                    videoElement.load();
                                    videoElement.removeAttribute('data-src');
                                    observer.unobserve(videoElement);
                                }
                            });
                        });
                        observer.observe(videoElement);
                    }
                    videoElement.addEventListener('mouseenter', () => {
                        if (videoElement.src || esLocal) {
                            videoElement.play().catch(e => {});
                        }
                    });
                    videoElement.addEventListener('mouseleave', () => {
                        videoElement.pause();
                        videoElement.currentTime = 0;
                    });
                    videoElement.onclick = (e) => {
                        e.stopPropagation();
                        const infoExtra = esLocal ? `\nArchivo: ${mediaData.nombreCompleto}\nTamano: ${mediaData.tamañoLegible}\nRuta: ${mediaData.ruta}` : '';
                        alert(`Video\n\nNombre: ${mediaData.nombre}\nOrigen: ${mediaData.repo}${infoExtra}`);
                    };
                    videoElement.onerror = function () {
                        this.style.background = 'linear-gradient(135deg, #f0f0f0, #e0e0e0)';
                    };
                } else {
                    pin.innerHTML = `
                        <div class="pin-image-container">
                            <img class="pin-image ${alturaAleatoria}" ${esLocal ? 'src' : 'data-src'}="${mediaData.url}" alt="${mediaData.nombre}" loading="lazy">
                            <button class="save-btn">Guardar</button>
                        </div>
                        <div class="pin-info">
                            <div class="pin-title">${mediaData.nombre}</div>
                            <div class="pin-description">${mediaData.repo}${esLocal && mediaData.tamañoLegible ? ' - ' + mediaData.tamañoLegible : ''}</div>
                            <div class="pin-creator">
                                <div class="creator-avatar">${esLocal ? 'PC' : 'GH'}</div>
                                <div class="creator-name">${esLocal ? 'Mi PC' : 'GitHub'}</div>
                            </div>
                        </div>
                    `;
                    const imgElement = pin.querySelector('img');
                    if (!esLocal && imgElement.dataset.src) {
                        const observer = new IntersectionObserver((entries) => {
                            entries.forEach(entry => {
                                if (entry.isIntersecting && imgElement.dataset.src) {
                                    imgElement.src = imgElement.dataset.src;
                                    imgElement.removeAttribute('data-src');
                                    observer.unobserve(imgElement);
                                }
                            });
                        });
                        observer.observe(imgElement);
                    }
                    imgElement.onclick = (e) => {
                        e.stopPropagation();
                     /*    const infoExtra = esLocal ? `\nArchivo: ${mediaData.nombreCompleto}\nTamano: ${mediaData.tamañoLegible}\nRuta: ${mediaData.ruta}` : '';
                        alert(`Imagen\n\nNombre: ${mediaData.nombre}\nOrigen: ${mediaData.repo}${infoExtra}`); */
                      calleditorpintaresta();
                    };
                    imgElement.onerror = function() {
                        this.style.background = 'linear-gradient(135deg, #f0f0f0, #e0e0e0)';
                        this.alt = 'Error al cargar';
                    };
                }
                const saveBtn = pin.querySelector('.save-btn');
                saveBtn.onclick = (e) => {
                    e.stopPropagation();
                    if (esLocal) {
                        const a = document.createElement('a');
                        a.href = mediaData.url;
                        a.download = mediaData.nombreCompleto;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        alert(`Descargando: ${mediaData.nombreCompleto}`);
                    } else {
                        alert(`${esVideo ? 'Video' : 'Imagen'} guardado: ${mediaData.nombre}`);
                    }
                };
                return pin;
            }
            obtenerLoteActual() {
                const inicio = this.loteActual * this.imagenesPorLote;
                const fin = inicio + this.imagenesPorLote;
                const lote = this.urlsFiltradas.slice(inicio, fin);
                return this.barajarArray(lote);
            }
            actualizarBotones() {
                const totalLotes = Math.ceil(this.urlsFiltradas.length / this.imagenesPorLote);
                document.getElementById('btnBack').disabled = (this.loteActual === 0);
                document.getElementById('btnNext').disabled = (this.loteActual >= totalLotes - 1);
                const inicio = (this.loteActual * this.imagenesPorLote) + 1;
                const fin = Math.min((this.loteActual + 1) * this.imagenesPorLote, this.urlsFiltradas.length);
                const videos = this.urlsFiltradas.filter(m => m.tipo === 'video').length;
                const imagenes = this.urlsFiltradas.filter(m => m.tipo === 'imagen').length;
                document.getElementById('loteInfo').textContent = `${inicio}-${fin} de ${this.urlsFiltradas.length} (IMG ${imagenes} VID ${videos})`;
            }
            mostrarLote() {
                const contenedor = document.getElementById('pinsContainer');
                contenedor.innerHTML = '';
                const archivos = this.obtenerLoteActual();
                if (archivos.length === 0) {
                    contenedor.innerHTML = `<div style="text-align: center; padding: 40px; color: #767676; grid-column: 1/-1;">No hay archivos para mostrar</div>`;
                    return;
                }
                const fragmento = document.createDocumentFragment();
                archivos.forEach(mediaData => {
                    fragmento.appendChild(this.crearPinElement(mediaData));
                });
                contenedor.appendChild(fragmento);
                this.actualizarBotones();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
            filtrarMedia(termino) {
                if (!termino.trim()) {
                    this.urlsFiltradas = [...this.todasLasUrls];
                } else {
                    const busqueda = termino.toLowerCase();
                    this.urlsFiltradas = this.todasLasUrls.filter(media => 
                        media.nombre.toLowerCase().includes(busqueda) ||
                        media.repo.toLowerCase().includes(busqueda)
                    );
                }
                this.loteActual = 0;
                this.mostrarLote();
            }
            async siguienteLote() {
                const totalLotes = Math.ceil(this.urlsFiltradas.length / this.imagenesPorLote);
                if (this.loteActual < totalLotes - 1) {
                    this.loteActual++;
                    this.mostrarLote();
                }
            }
            async loteAnterior() {
                if (this.loteActual > 0) {
                    this.loteActual--;
                    this.mostrarLote();
                }
            }
            async recargar() {
                this.loteActual = 0;
                await this.iniciar();
            }
            async iniciar() {
                const urls = await this.cargarDesdeMultiplesRepos();
                if (urls.length > 0) {
                    this.todasLasUrls = urls;
                    this.urlsFiltradas = [...urls];
                    this.loteActual = 0;
                    this.mostrarLote();
                }
            }
              calleditorpintaresta=()=>{
                if(window.appEditorgioBasico    &&window.appEditorgioBasico .parentElement){

                 window.appEditorgioBasico .parentElement. openappf();  
                }
  
}
        }
        document.addEventListener('DOMContentLoaded', () => {
            const galeria = new PintarestaGallery();
            document.getElementById('btnBack').addEventListener('click', () => galeria.loteAnterior());
            document.getElementById('btnNext').addEventListener('click', () => galeria.siguienteLote());
            document.getElementById('btnReload').addEventListener('click', () => galeria.recargar());
            const fileInput = document.getElementById('fileInput');
            fileInput.addEventListener('change', (e) => {
                const files = e.target.files;
                if (files.length > 0) {
                    galeria.cargarArchivosLocales(files);
                }
            });
            const btnViewJSON = document.getElementById('btnViewJSON');
            btnViewJSON.addEventListener('click', () => {
                galeria.mostrarJSON();
            });
            const btnCloseModal = document.getElementById('btnCloseModal');
            btnCloseModal.addEventListener('click', () => {
                document.getElementById('modalJSON').classList.remove('active');
            });
            const btnCopyJSON = document.getElementById('btnCopyJSON');
            btnCopyJSON.addEventListener('click', () => {
                galeria.copiarJSON();
            });
            const btnDownloadJSON = document.getElementById('btnDownloadJSON');
            btnDownloadJSON.addEventListener('click', () => {
                galeria.descargarJSON();
            });
            const modalJSON = document.getElementById('modalJSON');
            modalJSON.addEventListener('click', (e) => {
                if (e.target === modalJSON) {
                    modalJSON.classList.remove('active');
                }
            });
            const searchInput = document.getElementById('searchInput');
            let searchTimeout;
            searchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    galeria.filtrarMedia(e.target.value);
                }, 300);
            });
            document.addEventListener('keydown', (e) => {
                if (modalJSON.classList.contains('active')) {
                    if (e.key === 'Escape') {
                        modalJSON.classList.remove('active');
                    }
                    return;
                }
                if (e.target.tagName === 'INPUT') return;
                if (e.key === 'ArrowLeft') galeria.loteAnterior();
                else if (e.key === 'ArrowRight') galeria.siguienteLote();
                else if (e.key === 'r' || e.key === 'R') galeria.recargar();
            });
            galeria.iniciar();
            window.galeriaPintaresta = galeria;
        });
    </script>
</body>
</html>
